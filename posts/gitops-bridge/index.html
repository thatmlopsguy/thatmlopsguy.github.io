<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Bridging the Gap: Implementing GitOps Bridge Pattern with Kind | That MLOps Guy</title>
<link rel=canonical href=https://thatmlopsguy.github.io/posts/gitops-bridge/><meta name=description content="Hi there! ğŸ‘‹ğŸ» I'm that mlops guy. Welcome to my blog."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta property="og:url" content="https://thatmlopsguy.github.io/posts/gitops-bridge/"><meta property="og:site_name" content="That MLOps Guy"><meta property="og:title" content="Bridging the Gap: Implementing GitOps Bridge Pattern with Kind"><meta property="og:description" content="As I reflect on my journey implementing the GitOps Bridge pattern, Iâ€™ve learned that itâ€™s not just another technical solution, itâ€™s a fundamental shift in how we manage our Kubernetes infrastructure. My experience began with a simple goal: to bridge the gap between creating Kubernetes clusters and managing them through GitOps.
Traditional approaches to Kubernetes management often create a disconnect between two critical phases: the infrastructure provisioning, where you create and configure the Kubernetes clusters using an IaC tool like terraform, and the addons/application management, where you deploy the required applications within those clusters: monitoring, compliance and security addons."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-16T00:00:00+00:00"><meta property="article:modified_time" content="2025-02-16T00:00:00+00:00"><meta property="article:tag" content="Gitops"><meta property="article:tag" content="Terraform"><meta property="article:tag" content="Argocd"><link rel=stylesheet href=https://thatmlopsguy.github.io/css/styles.eb50e0b3a6776897852cc1bf5edf79eafbbacf28611ed9a15440dfd87c18a99b97cced7df7518db42485243c901372c5b68a0831a91c53470e195664662a4ba9.css integrity="sha512-61Dgs6Z3aJeFLMG/Xt956vu6zyhhHtmhVEDf2HwYqZuXzO1991GNtCSFJDyQE3LFtooIMakcU0cOGVZkZipLqQ=="></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://thatmlopsguy.github.io/><div id=title><h1>That MLOps Guy</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-2x" aria-hidden=true></i></a></li><li><a href=/>ğŸ  Home</a></li><li><a href=/posts>âœï¸ Posts</a></li><li><a href=/notes>ğŸ“ Notes</a></li><li><a href=/projects>ğŸ‘¨â€ğŸ’» Projects</a></li><li><a href=/about>ğŸ‘‹ About</a></li><li><a href=/contact>âœ‰ï¸ Contact</a></li><li><a href=/hire>ğŸš€ Hire me</a></li><li><a href=/consulting>ğŸ“Š Consulting</a></li><li><a href=/uses>ğŸ’» Uses</a></li><li><a href=/colophon>ğŸ“® Colophon</a></li><li><a href=/more>â• More</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Bridging the Gap: Implementing GitOps Bridge Pattern with Kind</h1><div class=meta><div class=postdate><time datetime="2025-02-16 00:00:00 +0000 UTC" itemprop=datePublished>2025-02-16</time></div><div class=article-read-time><i class="far fa-clock"></i>
3 minute read</div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/gitops rel=tag>gitops</a>
,
<a class=tag-link href=/tags/terraform rel=tag>terraform</a>
,
<a class=tag-link href=/tags/argocd rel=tag>argocd</a></div></div></header><div class=content itemprop=articleBody><p>As I reflect on my journey implementing the GitOps Bridge pattern, I&rsquo;ve learned that it&rsquo;s not just another technical solution,
it&rsquo;s a fundamental shift in how we manage our Kubernetes infrastructure. My experience began with a simple goal: to bridge the
gap between creating Kubernetes clusters and managing them through GitOps.</p><p>Traditional approaches to Kubernetes management often create a disconnect between two critical phases: the infrastructure
provisioning, where you create and configure the Kubernetes clusters using an IaC tool like terraform, and the addons/application
management, where you deploy the required applications within those clusters: monitoring, compliance and security addons.</p><p>This separation leads to several challenges:</p><ul><li>Configuration drift between infrastructure and applications</li><li>Complex metadata management for cloud resources</li><li>Difficulty maintaining consistent states across systems</li><li>Challenges in handling workload identities and security configurations</li></ul><p><img alt=gitops_bridge src=https://raw.githubusercontent.com/gitops-bridge-dev/gitops-bridge/main/argocd/iac/terraform/examples/eks/getting-started/static/gitops-bridge.drawio.png></p><p>The GitOps Bridge transforms the traditional flow of infrastructure management. Terraform creates cloud resources and stores
their configuration metadata (such as account IDs and role ARNs) in a ArgoCD secret.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get secret -n argocd -l argocd.argoproj.io/secret-type<span style=color:#ff6ac1>=</span>cluster -o json | jq <span style=color:#5af78e>&#39;.items[0].metadata.annotations&#39;</span>
</span></span></code></pre></div><p>The output looks like the following:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ff6ac1>{</span>
</span></span><span style=display:flex><span>  <span style=color:#5af78e>&#34;addons_repo_basepath&#34;</span>: <span style=color:#5af78e>&#34;gitops&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#5af78e>&#34;addons_repo_path&#34;</span>: <span style=color:#5af78e>&#34;addons&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#5af78e>&#34;addons_repo_revision&#34;</span>: <span style=color:#5af78e>&#34;dev&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#5af78e>&#34;addons_repo_url&#34;</span>: <span style=color:#5af78e>&#34;https://github.com/thatmlopsguy/k8s-homelab&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#5af78e>&#34;cluster_name&#34;</span>: <span style=color:#5af78e>&#34;main&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#5af78e>&#34;environment&#34;</span>: <span style=color:#5af78e>&#34;prod&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>}</span>
</span></span></code></pre></div><p>This metadata serves as the bridge between infrastructure and applications. The GitOps engine, in this case ArgoCD, retrieves
this stored metadata and uses it to deploy Helm charts within the Kubernetes cluster, ensuring that applications have the necessary
configurations to interact with external cloud resources.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#ff6ac1>apiVersion</span>: argoproj.io/v1alpha1
</span></span><span style=display:flex><span><span style=color:#ff6ac1>kind</span>: ApplicationSet
</span></span><span style=display:flex><span><span style=color:#ff6ac1>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>name</span>: addons-kro
</span></span><span style=display:flex><span><span style=color:#ff6ac1>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>syncPolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>preserveResourcesOnDeletion</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>generators</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff6ac1>merge</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>mergeKeys</span>: [server]
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>generators</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ff6ac1>clusters</span>:
</span></span><span style=display:flex><span>              <span style=color:#ff6ac1>values</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>addonChart</span>: kro
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>addonChartVersion</span>: <span style=color:#ff9f43>0.2.1</span>
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>addonChartRepository</span>: ghcr.io/kro-run/kro
</span></span><span style=display:flex><span>              <span style=color:#ff6ac1>selector</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>matchExpressions</span>:
</span></span><span style=display:flex><span>                <span style=color:#78787e># only install kro if the terraform variable enable_kro is true</span>
</span></span><span style=display:flex><span>                  - <span style=color:#ff6ac1>key</span>: enable_kro
</span></span><span style=display:flex><span>                    <span style=color:#ff6ac1>operator</span>: In
</span></span><span style=display:flex><span>                    <span style=color:#ff6ac1>values</span>: [<span style=color:#5af78e>&#39;true&#39;</span>]
</span></span><span style=display:flex><span>          - <span style=color:#ff6ac1>clusters</span>:
</span></span><span style=display:flex><span>              <span style=color:#ff6ac1>selector</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>matchLabels</span>:
</span></span><span style=display:flex><span>                  <span style=color:#ff6ac1>environment</span>: dev
</span></span><span style=display:flex><span>              <span style=color:#ff6ac1>values</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>addonChartVersion</span>: <span style=color:#ff9f43>0.2.1</span>
</span></span><span style=display:flex><span>          - <span style=color:#ff6ac1>clusters</span>:
</span></span><span style=display:flex><span>              <span style=color:#ff6ac1>selector</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>matchLabels</span>:
</span></span><span style=display:flex><span>                  <span style=color:#ff6ac1>environment</span>: prod
</span></span><span style=display:flex><span>              <span style=color:#ff6ac1>values</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff6ac1>addonChartVersion</span>: <span style=color:#ff9f43>0.2.1</span>
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>name</span>: addon-{{name}}-{{values.addonChart}}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>project</span>: addons
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>sources</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff6ac1>repoURL</span>: <span style=color:#5af78e>&#39;{{metadata.annotations.addons_repo_url}}&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>targetRevision</span>: <span style=color:#5af78e>&#39;{{metadata.annotations.addons_repo_revision}}&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>ref</span>: values
</span></span><span style=display:flex><span>        - <span style=color:#ff6ac1>chart</span>: <span style=color:#5af78e>&#39;{{values.addonChart}}&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>repoURL</span>: <span style=color:#5af78e>&#39;{{values.addonChartRepository}}&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>targetRevision</span>: <span style=color:#5af78e>&#39;{{values.addonChartVersion}}&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>helm</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>releaseName</span>: <span style=color:#5af78e>&#39;{{values.addonChart}}&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>ignoreMissingValueFiles</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>valueFiles</span>:
</span></span><span style=display:flex><span>              - $values/environments/default/addons/{{values.addonChart}}/values.yaml
</span></span><span style=display:flex><span>              - $values/environments/{{metadata.labels.environment}}/addons/{{values.addonChart}}/values.yaml
</span></span><span style=display:flex><span>              - $values/clusters/{{name}}/addons/{{values.addonChart}}/values.yaml
</span></span><span style=display:flex><span>            <span style=color:#78787e># if you need to pass variables from the argocd secret</span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>#values: |</span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>#  region: {{metadata.annotations.aws_region}}</span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>#  serviceAccount:</span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>#    name: {{metadata.annotations.service_account}}</span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>#    annotations:</span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>#        eks.amazonaws.com/role-arn: {{metadata.annotations.iam_role_arn}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>destination</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>namespace</span>: <span style=color:#5af78e>&#39;{{values.addonChart}}&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>name</span>: <span style=color:#5af78e>&#39;{{name}}&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>syncPolicy</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>automated</span>: {}
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>syncOptions</span>:
</span></span><span style=display:flex><span>          - CreateNamespace=true
</span></span></code></pre></div><p>My implementation journey began with a Kind cluster, which proved to be the perfect environment for learning and experimentation.
I chose Kind because it runs entirely on my local machine, providing complete isolation while still offering all the features needed
to test complex GitOps patterns. The Kind cluster became my playground for understanding how metadata flows between different systems
and how the GitOps Bridge pattern maintains consistency across infrastructure and applications.</p><p>One of the most valuable insights I gained was how the GitOps Bridge handles cloud service integrations. Even though I was working with
a local Kind cluster, I could simulate many of the challenges that arise in production environments. The bridge pattern helped me manage
workload identities and resource configurations in a way that would scale seamlessly to cloud-managed clusters later.</p><p>Once I implemented the GitOps Bridge pattern, everything fell into place. The bridge pattern became the glue that held
everything together, ensuring that the infrastructure and application configurations remained synchronized.</p><p>Looking back, implementing the GitOps Bridge pattern was less about technology and more about understanding the flow of information in
the infrastructure. It taught me that successful GitOps isn&rsquo;t just about automation â€“ it&rsquo;s about creating a clear, maintainable path for
configuration changes to flow through your entire system.</p><p>My implementation of the GitOps Bridge pattern is available in my kubernetes homelab <a href=https://github.com/thatmlopsguy/k8s-homelab>here</a>.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>ğŸ  Home</a></li><li><a href=/posts>âœï¸ Posts</a></li><li><a href=/notes>ğŸ“ Notes</a></li><li><a href=/projects>ğŸ‘¨â€ğŸ’» Projects</a></li><li><a href=/about>ğŸ‘‹ About</a></li><li><a href=/contact>âœ‰ï¸ Contact</a></li><li><a href=/hire>ğŸš€ Hire me</a></li><li><a href=/consulting>ğŸ“Š Consulting</a></li><li><a href=/uses>ğŸ’» Uses</a></li><li><a href=/colophon>ğŸ“® Colophon</a></li><li><a href=/more>â• More</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents></nav></div></div></div><footer id=footer><div class=footer-left>Made with â¤ï¸ by That MLOps Guy. Last Update: 2025-04-09.
Source code available <a href=https://github.com/thatmlopsguy/thatmlopsguy.github.io>here</a>.<nav><ul><li><a href=/>ğŸ  Home</a></li><li><a href=/posts>âœï¸ Posts</a></li><li><a href=/notes>ğŸ“ Notes</a></li><li><a href=/projects>ğŸ‘¨â€ğŸ’» Projects</a></li><li><a href=/about>ğŸ‘‹ About</a></li><li><a href=/contact>âœ‰ï¸ Contact</a></li><li><a href=/hire>ğŸš€ Hire me</a></li><li><a href=/consulting>ğŸ“Š Consulting</a></li><li><a href=/uses>ğŸ’» Uses</a></li><li><a href=/colophon>ğŸ“® Colophon</a></li><li><a href=/more>â• More</a></li></ul></nav></div></footer></div></body><script src=/js/code-copy.js></script></html>